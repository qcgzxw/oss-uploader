name: Build and Release

on:
  push:
    tags:
      - 'v*' # ä»…å½“æ¨é€ v1.0, v2.0 ç­‰æ ‡ç­¾æ—¶è§¦å‘
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write

jobs:
  build:
    name: Build for ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        include:
          # --- Windows ---
          - os: windows-latest
            artifact_name: OSS-Uploader-Windows.exe
            build_cmd: pyinstaller --onefile --windowed --icon=assets/logo.ico --name "OSS-Uploader-Windows" src/main.py
            asset_path: dist/OSS-Uploader-Windows.exe
          
          # --- macOS ---
          - os: macos-latest
            artifact_name: OSS-Uploader-MacOS
            build_cmd: pyinstaller --onefile --windowed --icon=assets/logo.icns --name "OSS-Uploader-MacOS" src/main.py
            asset_path: dist/OSS-Uploader-MacOS
          
          # --- Linux ---
          - os: ubuntu-latest
            artifact_name: OSS-Uploader-Linux
            build_cmd: pyinstaller --onefile --windowed --name "OSS-Uploader-Linux" src/main.py
            asset_path: dist/OSS-Uploader-Linux

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4  # å‡çº§åˆ° v4

      - name: Setup Python
        uses: actions/setup-python@v5  # å‡çº§åˆ° v5
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: Build Executable
        run: ${{ matrix.build_cmd }}

      - name: Upload Build Artifacts (Temp)
        uses: actions/upload-artifact@v4  # ğŸ”¥ å…³é”®ä¿®å¤: å‡çº§åˆ° v4
        with:
          name: ${{ matrix.artifact_name }}
          path: ${{ matrix.asset_path }}

      - name: Release to GitHub
        uses: softprops/action-gh-release@v2 # å»ºè®®å‡çº§åˆ° v2
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: ${{ matrix.asset_path }}
